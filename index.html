<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WINGO CHICKEN</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>

:root{--brand:#2E7D32;--fg:#111;--muted:#6b7280}
*{box-sizing:border-box}
html,body{margin:0;font-family:Inter,system-ui,'Segoe UI',Roboto,Arial,sans-serif;background:#fff;color:var(--fg)}
#verBadge{position:fixed;right:8px;top:8px;background:var(--brand);color:#fff;padding:4px 8px;border-radius:8px;font:12px/1 Inter, sans-serif;z-index:9999;opacity:.9}
.app-header{position:sticky;top:0;z-index:40;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:14px 16px}
.app-header .brand{font-weight:700;letter-spacing:.3px}
button{cursor:pointer;border:0;background:#eee;padding:10px 12px;border-radius:12px}
button.ghost{background:#fff;color:var(--brand);border:1px solid rgba(0,0,0,.08)}
button.primary{background:var(--brand);color:#fff}
button.mini{width:36px;height:36px;border-radius:10px;background:#fff;border:1px solid rgba(0,0,0,.1)}
.tabs{position:sticky;top:56px;z-index:39;background:#fff;display:flex;gap:8px;padding:8px 12px;border-bottom:1px solid rgba(0,0,0,.06)}
.tab{padding:8px 12px;border-radius:999px;background:#f2f4f5}
.tab.active{background:rgba(46,125,50,.1);color:#1f5c23;border:1px solid rgba(46,125,50,.15)}
.grid{padding:12px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
.card{border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:12px}
.card .title{font-weight:600;margin:0 0 6px}
.card .price{font-weight:600}
.muted{color:var(--muted)}
.cartbar{position:sticky;bottom:0;z-index:40;display:flex;justify-content:space-between;align-items:center;padding:12px;background:#fff;border-top:1px solid rgba(0,0,0,.06)}
.modal{position:fixed;inset:0;display:flex;align-items:flex-end;background:rgba(0,0,0,.3)}
.modal.hidden{display:none}
.dialog{background:#fff;border-radius:16px 16px 0 0;padding:16px;min-height:40vh;width:100%}
.close{position:absolute;right:16px;top:12px;background:#e8f3ea;color:var(--brand)}
.opt-title{font-weight:600;margin-top:12px}
.opt-hint{font-size:12px;color:var(--muted)}
.options{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;margin-top:6px}
.opt{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:1px solid rgba(0,0,0,.08);border-radius:12px;background:#fff}
.opt .nm{font-weight:500}
.opt .dot{width:12px;height:12px;border-radius:999px;border:1px solid rgba(0,0,0,.08);margin-right:6px}
.opt .heat{font-size:12px;opacity:.9}
.qtyrow{display:flex;gap:8px;align-items:center;margin-top:14px}
#sheetDesc{color:var(--muted);margin-top:4px;line-height:1.45}

</style>
</head>
<body>
  <div id="verBadge">v28</div>
  <header class="app-header">
    <div class="brand">WINGO CHICKEN</div>
    <button id="geoBtn" class="ghost">Проверить доставку</button>
  </header>

  <div id="tabs" class="tabs"></div>
  <main id="grid" class="grid"></main>

  <footer id="cartBar" class="cartbar">
    <div class="cartinfo"><span id="cartCount">0</span> поз. · <span id="cartTotal">₸0</span></div>
    <button id="checkoutBtn" class="primary">Оформить</button>
  </footer>

  <!-- Sheet modal -->
  <div id="sheet" class="modal hidden" role="dialog">
    <div class="dialog">
      <button class="close" id="sheetClose">×</button>
      <h2 id="sheetTitle"></h2>
      <p id="sheetDesc" class="muted"></p>

      <div class="opt-block" id="flavorBlock">
        <div class="opt-title">Выберите вкус</div>
        <div id="flavorOptions" class="options"></div>
        <div id="flavorHint" class="opt-hint"></div>
      </div>

      <div class="opt-block" id="dipsBlock">
        <div class="opt-title">Дип-соусы</div>
        <div class="opt-hint" id="dipsInfo"></div>
        <div class="options" id="dipsChoice"></div>
        <div class="opt-hint" id="dipsLeftHint"></div>
      </div>

      <div class="opt-block" id="drinksBlock">
        <div class="opt-title">Напитки</div>
        <div class="opt-hint" id="drinksInfo"></div>
        <div class="options" id="drinksChoice"></div>
        <div class="opt-hint" id="drinksLeftHint"></div>
      </div>

      <div class="qtyrow">
        <button id="minus" class="mini">−</button>
        <span id="qty">1</span>
        <button id="plus" class="mini">+</button>
        <button id="addToCart" class="primary">В корзину</button>
      </div>
    </div>
  </div>

  <!-- Checkout modal -->
  <div id="checkout" class="modal hidden" role="dialog">
    <div class="dialog">
      <button class="close" id="checkoutClose">×</button>
      <h2>Заказ</h2>
      <div id="orderList"></div>
      <div class="actions">
        <button id="waBtn" class="primary">Оформить в WhatsApp</button>
      </div>
    </div>
  </div>

  
<script>

// Embedded data to avoid any network issues
const MENU_EMBED = {"items": [{"id": "combo-wings-6", "category": "SOLO", "name": "Комбо крылышки (6)", "description": "6 крыльев, гарнир на выбор, 1 дип, напиток 0.5 л", "price": 3990, "flavors_max": 1, "garnish": {"options": ["Картофель фри", "Овощные палочки"]}, "dips_included": 1, "image": "images/1.webp"}, {"id": "solo-mix-5-2", "category": "SOLO", "name": "Solo MIX (5 крыльев + 2 тендерса)", "description": "1 дип-соус включён", "price": 2990, "flavors_max": 1, "garnish": {"options": ["Картофель фри", "Овощные палочки"]}, "dips_included": 1, "image": "images/2.webp"}, {"id": "wings-10", "category": "SOLO", "name": "Крылышки (10)", "description": "Дип не входит", "price": 2790, "flavors_max": 1, "image": "images/3.webp"}, {"id": "combo-tenders-5", "category": "SOLO", "name": "Комбо тендерсы (5)", "description": "Гарнир на выбор, 1 дип, напиток 0.5 л", "price": 4390, "flavors_max": 1, "garnish": {"options": ["Картофель фри", "Овощные палочки"]}, "dips_included": 1, "image": "images/4.webp"}, {"id": "tenders-4", "category": "SOLO", "name": "Тендерсы (4)", "description": "1 дип включён", "price": 2590, "flavors_max": 1, "dips_included": 1, "image": "images/5.webp"}, {"id": "duo-mix-12-4", "category": "DUO", "name": "Duo MIX (12 крыльев + 4 тендерса)", "description": "2 дипа включено", "price": 6690, "flavors_max": 2, "garnish": {"options": ["Картофель фри", "Овощные палочки"]}, "dips_included": 2, "image": "images/6.webp"}, {"id": "duo-wings-15", "category": "DUO", "name": "Сет на двоих (15 крыльев)", "description": "Гарнир на выбор, 2 дипа, 2 напитка 0.5 л", "price": 6890, "flavors_max": 2, "garnish": {"options": ["Картофель фри", "Овощные палочки"]}, "dips_included": 2, "image": "images/7.webp"}, {"id": "friends-30", "category": "СЕТЫ НА КОМПАНИЮ", "name": "Friends 30", "description": "20 крыльев + 10 тендерсов, 6 дипов", "price": 9590, "flavors_max": 3, "dips_included": 6, "image": "images/8.webp"}, {"id": "hangout-50", "category": "СЕТЫ НА КОМПАНИЮ", "name": "Hangout 50", "description": "34 крыльев + 16 тендерсов, 8 дипов", "price": 14590, "flavors_max": 4, "dips_included": 8, "image": "images/9.webp"}, {"id": "fries", "category": "ГАРНИРЫ", "name": "Картофель фри", "description": "Горячий и хрустящий. Wingo Seasoning.", "price": 790, "image": "images/10.webp"}, {"id": "corn", "category": "ГАРНИРЫ", "name": "Жареная кукуруза", "description": "6 кусочков с фирменной приправой.", "price": 1890, "image": "images/11.webp"}, {"id": "dip-ranch", "category": "СОУСЫ (ДИПЫ)", "name": "Ранч", "description": "Сливочный, с зеленью.", "price": 380, "image": "images/12.webp"}, {"id": "dip-cheese", "category": "СОУСЫ (ДИПЫ)", "name": "Сырный соус", "description": "Сливочно-сырный.", "price": 380, "image": "images/13.webp"}, {"id": "dip-sweetspicy", "category": "СОУСЫ (ДИПЫ)", "name": "Сладко-острый", "description": "Сладость + остринка.", "price": 380, "image": "images/14.webp"}, {"id": "dip-bbq", "category": "СОУСЫ (ДИПЫ)", "name": "BBQ", "description": "Классика с дымком.", "price": 380, "image": "images/15.webp"}, {"id": "dip-honey-mustard", "category": "СОУСЫ (ДИПЫ)", "name": "Медово-горчичный", "description": "Сладко и пикантно.", "price": 380, "image": "images/16.webp"}, {"id": "coke-05", "category": "НАПИТКИ", "name": "Coca-Cola 0,5", "description": "Освежает.", "price": 890, "image": "images/17.webp"}, {"id": "fuse-05", "category": "НАПИТКИ", "name": "Fuse Tea 0,5", "description": "Холодный чай.", "price": 790, "image": "images/18.webp"}, {"id": "water-asu-05", "category": "НАПИТКИ", "name": "Вода Asu 0,5", "description": "Негазированная.", "price": 690, "image": "images/19.webp"}]};
const CONFIG_EMBED = {"whatsapp_number": "77071052828", "utm": "?utm_source=qr&utm_medium=menu&utm_campaign=wingo", "business_hours": {"daily": {"open": "11:00", "close": "23:00"}}, "dip_unit_price": 380, "cooking_flavors": ["BBQ", "Медово-горчичный", "Wingo fire", "Сладко-острый"], "pickup": {"address": "Балкантау 94"}, "delivery": {"center": {"lat": 51.13192937251173, "lng": 71.47830351934499}, "radius_km": 1.5}};

const state = {
  menu: MENU_EMBED,
  conf: CONFIG_EMBED,
  cart: [],
  currentCat: null,
  sheetItem: null,
  sheetQty: 1,
  select: {flavors:[], dipCounts: {}, drinkCounts: {}, garnish: null},
};

const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];

function money(n){ try{return '₸'+(n||0).toLocaleString('ru-RU');}catch(e){return '₸'+(n||0)} }

function init(){
  buildCategories();
  renderGrid();
  bindGlobal();
}

function buildCategories(){
  const cats = [...new Set(state.menu.items.map(x=>x.category))];
  state.currentCat = state.currentCat || cats[0];
  const tabs = $('#tabs');
  tabs.innerHTML = '';
  cats.forEach(c=>{
    const b = document.createElement('button');
    b.className = 'tab' + (c===state.currentCat?' active':'');
    b.textContent = c;
    b.onclick = ()=>{ state.currentCat=c; buildCategories(); renderGrid(); };
    tabs.appendChild(b);
  });
}

function renderGrid(){
  const grid = $('#grid');
  const arr = state.menu.items.filter(x=>x.category===state.currentCat);
  grid.innerHTML = '';
  arr.forEach(it=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <div class="title"></div>
      <div class="muted"></div>
      <div class="price"></div>
    `;
    card.querySelector('.title').textContent = it.name;
    card.querySelector('.muted').textContent = it.description || '';
    card.querySelector('.price').textContent = money(it.price);
    card.onclick = ()=> openSheet(it);
    grid.appendChild(card);
  });
}

function bindGlobal(){
  $('#checkoutBtn').onclick = openCheckout;
  $('#waBtn').onclick = sendWA;
  $('#sheetClose').onclick = closeSheet;
  $('#checkoutClose').onclick = closeCheckout;
}

function openSheet(it){
  state.sheetItem = it; state.sheetQty=1;
  state.select = {flavors:[], dipCounts: {}, drinkCounts: {}, garnish:null};
  $('#sheetTitle').textContent = it.name;
  $('#sheetDesc').textContent = it.description || '';

  // flavors
  const flWrap = $('#flavorOptions'); flWrap.innerHTML='';
  const flavors = state.conf.cooking_flavors || [];
  flavors.forEach(fl=>{ 
    const name = typeof fl==='string'? fl : (fl.name||'');
    const heat = typeof fl==='object'? (fl.heat||0):0;
    const color = typeof fl==='object'? (fl.color||''):'';
    const btn = document.createElement('button');
    btn.className='opt flavor';
    btn.innerHTML = `<span class="dot" style="${color?`background:${color}`:''}"></span><span class="nm">${name}</span><span class="heat">${'🌶'.repeat(Math.max(0, Math.min(3, heat)))}</span>`;
    btn.onclick = ()=>{ toggleFlavor(name, it.flavors_max||1); };
    flWrap.appendChild(btn);
  });
  updateFlavorHint();

  // dips included
  const di = it.dips_included||0;
  const dipBlock = $('#dipsBlock');
  if(di>0){
    dipBlock.style.display='';
    $('#dipsInfo').textContent = `Входит: ${di} дип` + (di===1?'':'ов');
    const box = $('#dipsChoice'); box.innerHTML='';
    const dips = state.conf.dip_flavors||[];
    dips.forEach(name=>{
      state.select.dipCounts[name]=0;
      const row = document.createElement('div'); row.className='opt';
      row.innerHTML = `<span class="nm">${name}</span><div class="ctr"><button class="mini">−</button><span class="v">0</span><button class="mini">+</button></div>`;
      const btns = row.querySelectorAll('button.mini'); const label = row.querySelector('.v');
      const update=()=>{ label.textContent = state.select.dipCounts[name]; const left = di - Object.values(state.select.dipCounts).reduce((a,b)=>a+b,0); $('#dipsLeftHint').textContent = left>0?`Осталось распределить: ${left}`:'Распределено полностью'; };
      btns[0].onclick = ()=>{ if(state.select.dipCounts[name]>0){state.select.dipCounts[name]--; update();} };
      btns[1].onclick = ()=>{ const sum=Object.values(state.select.dipCounts).reduce((a,b)=>a+b,0); if(sum<di){state.select.dipCounts[name]++; update();} };
      box.appendChild(row); update();
    });
  } else { dipBlock.style.display='none'; }

  // drinks included
  const dr = it.drinks_included||0;
  const drinkBlock = $('#drinksBlock');
  if(dr>0){
    drinkBlock.style.display='';
    $('#drinksInfo').textContent = `Входит: ${dr} напиток` + (dr===1?'':'а');
    const box = $('#drinksChoice'); box.innerHTML='';
    const drinks = state.conf.drink_flavors||[];
    drinks.forEach(name=>{
      state.select.drinkCounts[name]=0;
      const row = document.createElement('div'); row.className='opt';
      row.innerHTML = `<span class="nm">${name}</span><div class="ctr"><button class="mini">−</button><span class="v">0</span><button class="mini">+</button></div>`;
      const btns=row.querySelectorAll('button.mini'); const label=row.querySelector('.v');
      const update=()=>{ label.textContent = state.select.drinkCounts[name]; const left = dr - Object.values(state.select.drinkCounts).reduce((a,b)=>a+b,0); $('#drinksLeftHint').textContent = left>0?`Осталось распределить: ${left}`:'Распределено полностью'; };
      btns[0].onclick=()=>{ if(state.select.drinkCounts[name]>0){ state.select.drinkCounts[name]--; update(); }};
      btns[1].onclick=()=>{ const sum=Object.values(state.select.drinkCounts).reduce((a,b)=>a+b,0); if(sum<dr){ state.select.drinkCounts[name]++; update(); }};
      box.appendChild(row); update();
    });
  } else { drinkBlock.style.display='none'; }

  // qty/add
  $('#qty').textContent = '1';
  $('#minus').onclick = ()=>{ if(state.sheetQty>1){state.sheetQty--; $('#qty').textContent=String(state.sheetQty);} };
  $('#plus').onclick = ()=>{ state.sheetQty++; $('#qty').textContent=String(state.sheetQty); };
  $('#addToCart').onclick = addToCart;
  $('#sheet').classList.remove('hidden');
}

function toggleFlavor(name, max){
  const a = state.select.flavors;
  const i = a.indexOf(name);
  if(i>=0) a.splice(i,1);
  else if(a.length < max) a.push(name);
  updateFlavorHint();
}
function updateFlavorHint(){
  const it = state.sheetItem||{};
  const cnt = (state.select.flavors||[]).length;
  $('#flavorHint').innerHTML = `Выбрано ${cnt} из ${it.flavors_max||1}. <span class='muted'>🌶 0 — неострое · 1 — средняя · 3 — острое</span>`;
}
function closeSheet(){ $('#sheet').classList.add('hidden'); }

function addToCart(){
  const it = state.sheetItem;
  const item = {
    name: it.name, 
    price: it.price,
    qty: state.sheetQty,
    flavors: [...(state.select.flavors||[])],
    dips_included: it.dips_included||0,
    includedDipBreakdown: state.select.dipCounts,
    drinks_included: it.drinks_included||0,
    includedDrinkBreakdown: state.select.drinkCounts
  };
  state.cart.push(item);
  closeSheet();
  updateCartBar();
}

function updateCartBar(){
  const cnt = state.cart.reduce((a,c)=>a+c.qty,0);
  const sum = state.cart.reduce((a,c)=>a+c.qty*c.price,0);
  $('#cartCount').textContent = String(cnt);
  $('#cartTotal').textContent = money(sum);
}

function openCheckout(){
  const box = $('#orderList'); box.innerHTML='';
  state.cart.forEach(c=>{
    const div = document.createElement('div');
    const extras = [];
    if(c.flavors?.length) extras.push('вкусы: '+c.flavors.join(', '));
    if(c.dips_included){
      const br=c.includedDipBreakdown||{}; const pairs=Object.keys(br).filter(k=>br[k]>0).map(k=>`${k}×${br[k]}`);
      extras.push('входит дипов: '+c.dips_included + (pairs.length?'; '+pairs.join(', '):''));
    }
    if(c.drinks_included){
      const brd=c.includedDrinkBreakdown||{}; const pairsd=Object.keys(brd).filter(k=>brd[k]>0).map(k=>`${k}×${brd[k]}`);
      extras.push('входит напитков: '+c.drinks_included + (pairsd.length?'; '+pairsd.join(', '):''));
    }
    div.textContent = `${c.name} × ${c.qty} — ${money(c.price*c.qty)}${extras.length?' ('+extras.join('; ')+')':''}`;
    box.appendChild(div);
  });
  $('#checkout').classList.remove('hidden');
}
function closeCheckout(){ $('#checkout').classList.add('hidden'); }

function sendWA(){
  const lines = state.cart.map(c=>{ 
    const extras=[];
    if(c.flavors?.length) extras.push('вкусы: '+c.flavors.join(', '));
    if(c.dips_included){
      const br=c.includedDipBreakdown||{}; const pairs=Object.keys(br).filter(k=>br[k]>0).map(k=>`${k}×${br[k]}`);
      if(pairs.length) extras.push('дипы: '+pairs.join(', '));
    }
    if(c.drinks_included){
      const brd=c.includedDrinkBreakdown||{}; const pairsd=Object.keys(brd).filter(k=>brd[k]>0).map(k=>`${k}×${brd[k]}`);
      if(pairsd.length) extras.push('напитки: '+pairsd.join(', '));
    }
    return `• ${c.name} × ${c.qty} — ${money(c.price*c.qty)}${extras.length?' ('+extras.join('; ')+')':''}`;
  });
  const total = state.cart.reduce((a,c)=>a+c.qty*c.price,0);
  const text = encodeURIComponent('Заказ:\n'+lines.join('\n')+'\nИтого: '+money(total));
  location.href = 'https://wa.me/?text='+text;
}

document.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>
